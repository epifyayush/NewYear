<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystic Falls — 10 Questions (TVD-style, slow)</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#040403; --ink:#efe7d8; --gold:#c6a86f; --muted: rgba(200,170,110,0.04); --accent: rgba(220,180,110,0.08);
}
html,body{height:100%;margin:0;background: radial-gradient(circle at 10% 8%, #0b0b0b 0%, #070706 30%, #020202 100%); color:var(--ink); font-family:"Playfair Display", serif; -webkit-font-smoothing:antialiased;}
/* Progress */
#progressWrap{position:fixed;left:50%;transform:translateX(-50%);top:12px;z-index:200;width:66%;max-width:980px;min-width:420px;display:flex;gap:12px;align-items:center;pointer-events:none;font-family:"Cinzel",serif;color:var(--gold);letter-spacing:1px;font-size:13px}
#progressBar{height:9px;background: rgba(255,255,255,0.02);border-radius:999px;overflow:hidden;flex:1;box-shadow:0 6px 26px rgba(0,0,0,0.45)}
#progressInner{height:100%;width:0%;background: linear-gradient(90deg, rgba(210,165,80,0.95), rgba(230,190,110,0.95));transition: width 900ms cubic-bezier(.2,.8,.2,1);}

/* Characters & glow */
.character{position:fixed;bottom:0;z-index:150;pointer-events:none}
#damon{left:-1.6vw;width:18.5vw;max-width:320px}
#stefan{right:-1.6vw;width:16.2vw;max-width:300px}
.character .glow{position:absolute;left:50%;transform:translateX(-50%) translateY(9vh);bottom:6vh;width:78%;height:58%;pointer-events:none;z-index:0;background: radial-gradient(circle, rgba(220,180,110,0.18) 0%, rgba(220,180,110,0.10) 30%, rgba(0,0,0,0) 60%);filter: blur(36px);opacity:0.32;border-radius:50%;transition:opacity .45s ease,filter .45s ease,transform .45s ease}
.character img{position:relative;z-index:2;width:100%;height:auto;display:block;object-fit:contain;transition:transform .48s ease,filter .48s ease; -webkit-user-drag:none;}
#damon img{max-height:54vh} /* Damon visually shorter */
.character.speaking .glow{opacity:1;filter: blur(68px) saturate(1.05);transform:translateX(-50%) translateY(6.2vh) scale(1.06)}
.character.speaking img{transform:translateY(-0.9vh) scale(1.02);filter: drop-shadow(0 0 78px rgba(220,180,120,0.45))}

/* UI */
#ui{position:relative;max-width:980px;margin:110px auto 10vh auto;padding:24px;z-index:160;text-align:center}
#speaker{font-family:"Cinzel",serif;color:var(--gold);letter-spacing:1.6px;margin-bottom:10px;font-size:13px;opacity:0.98}
#dialogue{min-height:420px;margin:0 auto;padding:10px 20px;box-sizing:border-box}
.line{color:var(--ink);font-size:22px;line-height:1.98;margin:12px 0;text-align:center;max-width:900px;margin-left:auto;margin-right:auto;opacity:0.999}
.reply{font-size:18px;margin-top:10px;color:var(--ink)}
.meta{font-family:"Cinzel",serif;color:var(--gold);font-size:14px;margin-top:12px}

/* options - fade-in and slow appearance */
#question{margin-top:16px;font-family:"Cinzel",serif;color:var(--gold);font-size:18px;letter-spacing:0.6px}
#instruction{font-size:13px;opacity:0.78;margin-top:8px}
#options{margin-top:22px;display:flex;flex-direction:column;gap:14px;align-items:center;justify-content:center;z-index:166}
.optionBtn{min-width:420px;max-width:820px;width:48%;padding:14px 18px;border:1px solid rgba(200,170,110,0.22);background:transparent;color:var(--ink);font-family:"Cinzel",serif;font-size:17px;cursor:pointer;transition:transform .28s cubic-bezier(.2,.8,.2,1),background .28s ease,box-shadow .28s ease,opacity .28s ease;opacity:0;transform:translateY(8px);outline:none}
.optionBtn.visible{opacity:1;transform:translateY(0);background:var(--accent);box-shadow:0 18px 38px rgba(0,0,0,0.45)}
.optionBtn:disabled{opacity:0.45;cursor:not-allowed}

/* continue button */
#continueWrap{margin-top:20px}
#finalWrap{margin-top:20px}

/* responsive */
@media (max-width:1000px){
  #progressWrap{display:none}
  #damon,#stefan{display:none}
  #ui{margin:48px 12px 8vh 12px}
  .optionBtn{width:86%}
  .line{font-size:18px}
}
</style>
</head>
<body>
<div id="progressWrap"><div id="stageText">Stage 0 / 0</div><div id="progressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div id="progressInner"></div></div></div>

<div class="character" id="damon"><div class="glow"></div><img src="damon.png" alt="Damon"></div>
<div class="character" id="stefan"><div class="glow"></div><img src="stefan.png" alt="Stefan"></div>

<div id="ui" role="main" aria-live="polite">
  <div id="speaker"></div>
  <div id="dialogue"></div>

  <div id="question"></div>
  <div id="instruction"></div>

  <div id="options" role="group" aria-label="Choices"></div>
  <div id="continueWrap"></div>
  <div id="finalWrap"></div>
</div>

<script>
/* CONFIG - very slow cinematic pace */
const namePrimary = "Nabanita";
const nameAlt = "Raii";

let TYPE_SPEED = 86;              // ms per character (very slow)
const PAUSE_SHORT = 1000;
const PAUSE_MED = 1800;
const PAUSE_LONG = 2600;

const speakerEl = document.getElementById('speaker');
const dialogueEl = document.getElementById('dialogue');
const questionEl = document.getElementById('question');
const instructionEl = document.getElementById('instruction');
const optionsEl = document.getElementById('options');
const continueWrap = document.getElementById('continueWrap');
const finalWrap = document.getElementById('finalWrap');
const progressInner = document.getElementById('progressInner');
const stageText = document.getElementById('stageText');

const damonNode = document.getElementById('damon');
const stefanNode = document.getElementById('stefan');

function setSpeaking(name){
  damonNode.classList.toggle('speaking', name === 'Damon');
  stefanNode.classList.toggle('speaking', name === 'Stefan');
}

/* tiny helpers */
function wait(ms){ return new Promise(r=>setTimeout(r, ms)); }
function clearUI(){ dialogueEl.innerHTML=''; questionEl.textContent=''; instructionEl.textContent=''; optionsEl.innerHTML=''; continueWrap.innerHTML=''; finalWrap.innerHTML=''; setSpeaking(null); }
function tokenizeHtml(s){ const re = /<[^>]+>|./g; const out=[]; let m; while((m=re.exec(s))!==null) out.push(m[0]); return out; }
function typeInto(el, text, speed = TYPE_SPEED){
  return new Promise(resolve=>{
    const tokens = tokenizeHtml(text);
    let i = 0;
    function step(){
      if(i >= tokens.length) return resolve();
      const t = tokens[i++];
      el.innerHTML += t;
      setTimeout(step, t.startsWith('<') ? Math.max(8, speed/6) : speed);
    }
    step();
  });
}
function newLine(cls='line'){ const d = document.createElement('div'); d.className = cls; dialogueEl.appendChild(d); setTimeout(()=> window.scrollTo({ top: window.scrollY + 8, behavior:'smooth' }), 100); return d; }
function setOptionsEnabled(v){ const bs = optionsEl.querySelectorAll('button'); bs.forEach(b=>b.disabled = !v); }

/* ---------------------------
   Scenes (10 interactive total)
   Each option has a 'dialogue' array consisting of objects:
     { speaker: 'Damon'|'Stefan', text: '...' }
   For factual questions, option.correct flags true; scenes set forceCorrect:true.
   For non-factual, every option simply continues and triggers long TVD-style banter.
   --------------------------- */

const scenes = [
  // 0 intro (continue)
  { id:'intro', who:'Damon', lines:[
    `Welcome to Mystic Falls, ${namePrimary}.`,
    `This is slow. This is theatrical. This is a tiny chaotic gift.`
  ], continue:true },

  // 1 pick character (interactive)
  { id:'pick', who:'Damon', lines:[`First: who would you take into a midnight plot?`],
    options:[
      {
        label: 'Damon — reckless charm',
        persona: 'Damon',
        dialogue: [
          { speaker:'Damon', text:`Well. Bold.... I like people who choose to be interesting.` },
          { speaker:'Stefan', text:`He will make things loud... But loud isn't always bad if you can stand the aftermath.` },
          { speaker:'Damon', text:`${namePrimary}, you pick risk with a grin. That tells me you enjoy stories with scars and laughter. I like You Rai, No need to compel you atleast` },
          { speaker:'Stefan', text:`Dont listen to him... you stay afterwards. That's the valuable part.` }
        ]
      },
      {
        label: 'Stefan — steady heart',
        persona: 'Stefan',
        dialogue: [
          { speaker:'Stefan', text:`A wise pick. Steadiness holds people together.` },
          { speaker:'Damon', text:`Boring in the best sense. She will read, you will come with tea.` },
          { speaker:'Stefan', text:`${namePrimary}, you keep warmth folded carefully. You prefer steady lights to fireworks.` },
          { speaker:'Damon', text:`I'll still make a joke about it later, but it's a respectable choice.` }
        ]
      },
      {
        label: 'Klaus — dangerous poetry',
        persona: 'Damon',
        dialogue: [
          { speaker:'Damon', text:`Klaus is beautiful chaos. You like a good storm, don't you girl!!` },
          { speaker:'Stefan', text:`He chooses his own world; it isn't for everyone. Rippahhh` },
          { speaker:'Damon', text:`${namePrimary}, you pick what excites you, even if it bruises. That says you're brave.` },
          { speaker:'Stefan', text:`Just promise you'll come home after the fireworks.` }
        ]
      }
    ]
  },

  // 2 mood
  { id:'mood', who:'Damon', lines:[`Choose tonight's mood — the questions will match it.`],
    options:[
      {
        label:'Mocking & warm',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Good. Mockery wrapped in affection. My favourite.` },
          { speaker:'Stefan', text:`You'll tease without cruelty. That balance is rare.` },
          { speaker:'Damon', text:`${namePrimary}, you wear sarcasm like a scarf — stylish and protective.` },
          { speaker:'Stefan', text:`It keeps people close when they should be kept close.` }
        ]
      },
      {
        label:'Quiet & reflective',
        persona:'Stefan',
        dialogue:[
          { speaker:'Stefan', text:`Soft, yes. We'll ask the quieter questions.` },
          { speaker:'Damon', text:`I'll be quieter too... for at least five minutes.` },
          { speaker:'Stefan', text:`${namePrimary}, you look at the edges of things. You notice small truths.` },
          { speaker:'Damon', text:`Don't let him make you too solemn — smile halfway through.` }
        ]
      },
      {
        label:'Chaotic & laughing',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Delicious. Give me chaos, jokes, and someone to roast.` },
          { speaker:'Stefan', text:`You like life that changes the script at the last second.` },
          { speaker:'Damon', text:`${namePrimary}, you pick the plot twist before anyone else sees it.` },
          { speaker:'Stefan', text:`I'll be the friend to steady you after.` }
        ]
      }
    ]
  },

  // 3 fan-moment
  { id:'fanMoment', who:'Damon', lines:[`As a TVD fan — which Damon moment do you rewatch?`],
    options:[
      {
        label:'His dry sarcasm',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Ah. The bite that hides a care. That's nuance.` },
          { speaker:'Stefan', text:`He uses it to hide soft things. You see the soft.` },
          { speaker:'Damon', text:`${namePrimary}, you like complexity: the grin that means trouble and protection.` },
          { speaker:'Stefan', text:`That taste suits you. You're not simple, either.` }
        ]
      },
      {
        label:'Brotherly softness with Stefan',
        persona:'Stefan',
        dialogue:[
          { speaker:'Stefan', text:`Those moments are quiet and honest.` },
          { speaker:'Damon', text:`He has a soft line from time to time. You notice it.` },
          { speaker:'Stefan', text:`${namePrimary}, you care about the small mercies. That's admirable.` },
          { speaker:'Damon', text:`I will roast you for it later, but it's good. Truly.` }
        ]
      },
      {
        label:'When he’s outright dangerous',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Yes. Dangerous Damon is art.` },
          { speaker:'Stefan', text:`Danger fascinates. It also warns.` },
          { speaker:'Damon', text:`${namePrimary}, you enjoy the edge — you flirt with peril for the story.` },
          { speaker:'Stefan', text:`And you come back down afterwards. That's important.` }
        ]
      }
    ]
  },

  // 4 romcom1 (force-correct factual)
  { id:'romcom1', who:'Damon', lines:[`Wll I heard that you are a fan of romcom? quick questions then , you will not mind right?: In 'To All the Boys I’ve Loved Before', who was the fake boyfriend?`],
    options:[
      {
        label: 'Peter Kavinsky',
        persona:'Damon',
        correct:true,
        dialogue:[
          { speaker:'Damon', text:`Correct. Peter fitting the bill — playful, distracting, unexpectedly kind.` },
          { speaker:'Stefan', text:`You know your romcoms. That's a small, lovely secret.` },
          { speaker:'Damon', text:`${namePrimary}, I did not expect romcom loyalty — I will use this against you.` }
        ]
      },
      {
        label: 'Josh',
        persona:'Stefan',
        correct:false,
        dialogue:[
          { speaker:'Stefan', text:`Not Josh in part one — he matters, but differently.` },
          { speaker:'Damon', text:`Wrong here. Hint: think of the boy who suddenly becomes very visible.` },
          { speaker:'Stefan', text:`Try again — you were warm to the idea, don't give up.` }
        ],
        hint: 'Think of the popular, goofy lead who becomes more.'
      },
      {
        label: 'John Ambrose',
        persona:'Damon',
        correct:false,
        dialogue:[
          { speaker:'Damon', text:`Not him in part one — John Ambrose arrives later.` },
          { speaker:'Stefan', text:`You remember the face. But not the sequence.` },
          { speaker:'Damon', text:`Try the other option — it fits the first film.` }
        ],
        hint: 'He appears in later chapters, not the first film.'
      }
    ],
    forceCorrect:true,
    afterCorrectLine: `— Damon: Romcom knowledge confirmed. I will tease you with it.`
  },

  // 5 romcom2 (force-correct factual)
  { id:'romcom2', who:'Damon', lines:[`Who accidentally mailed Lara Jean's private letters?`],
    options:[
      {
        label: 'Kitty',
        persona:'Damon',
        correct:true,
        dialogue:[
          { speaker:'Damon', text:`Right. Kitty — small chaos with big consequences.` },
          { speaker:'Stefan', text:`A sister's mischief — honest and very human.` },
          { speaker:'Damon', text:`${namePrimary}, you remember details. That will serve you well....` }
        ]
      },
      {
        label: 'Margot',
        persona:'Stefan',
        correct:false,
        dialogue:[
          { speaker:'Stefan', text:`Not Margot — she helps, but doesn't mail them.` },
          { speaker:'Damon', text:`Wrong here; hint: the person with the closest, messy care for Lara Jean.` },
          { speaker:'Stefan', text:`Think 'little sister energy'. Try again.` }
        ],
        hint: 'Think of the sister with lively impulses.'
      },
      {
        label: 'Peter',
        persona:'Damon',
        correct:false,
        dialogue:[
          { speaker:'Damon', text:`Nope — Peter didn't send them.` },
          { speaker:'Stefan', text:`He reacts to the fallout, but wasn't the sender.` },
          { speaker:'Damon', text:`Look for the option that makes familial sense.` }
        ],
        hint: 'Not Peter — family involvement fits better.'
      }
    ],
    forceCorrect:true,
    afterCorrectLine: `— Damon: I will mock you lovingly for romcom taste.`
  },

  // 6 coffee (personal, non-fact)
  { id:'coffee', who:'Stefan', lines:[`If life tastes like black coffee, what would you add to make it gentler?`],
    options:[
      {
        label: 'A spoon of honey',
        persona:'Stefan',
        dialogue:[
          { speaker:'Stefan', text:`Honey?? Small comfort that spreads.` },
          { speaker:'Damon', text:`Sweetness hidden in bitterness — that's very you, ${namePrimary}. I would just advice you to go and drink blood, but anyway..` },
          { speaker:'Stefan', text:`Sometimes the smallest addition changes the whole cup. You know that.,` },
          { speaker:'Damon', text:`I'll poke you for being soft but I'll bring the honey next time...Yeah that's meee...` }
        ]
      },
      {
        label: 'Call someone who listens',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Call someone? Yeah I loves to talk to Elena.. Share with her, and then make her compel to forget, you know me..` },
          { speaker:'Stefan', text:`Asking for help is strength disguised as a small ask....` },
          { speaker:'Damon', text:`${namePrimary}, you remember people. You hold details and remember to ask.` },
          { speaker:'Stefan', text:`That choice is quietly good.... I prefer to talk to Lexi the same way... So I approve.. ` }
        ]
      },
      {
        label: 'A short trip somewhere new',
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Travel resets the script. Go. Run. Come back different...Like I used to do` },
          { speaker:'Stefan', text:`New places rearrange old weight. It helps...` },
          { speaker:'Damon', text:`You like adventures, collecting stories, ${namePrimary}. That's beautiful, but very stefan...` },
          { speaker:'Stefan', text:`WEllll... Bring photos. We'll listen to all of them....` }
        ]
      }
    ]
  },

  // 7 quote (factual, force)
  { id:'quote', who:'Damon', lines:[`Who said: "When I kill someone, they're supposed to stay dead!"`],
    options:[
      {
        label: 'Damon Salvatore',
        persona:'Damon',
        correct:true,
        dialogue:[
          { speaker:'Damon', text:`Correct..... I said that...Well you know me very well, who are you!!` },
          { speaker:'Stefan', text:`Rai You know the gritty lines... Good memory.` },
          { speaker:'Damon', text:`${namePrimary}, you pay attention to tone as much as words.....` }
        ]
      },
      {
        label: 'Klaus',
        persona:'Stefan',
        correct:false,
        dialogue:[
          { speaker:'Stefan', text:`Not Klaus for that one.... You are making me remeber Rippah..` },
          { speaker:'Damon', text:`oh not Rippahhh... but Rai You were close on menace though — try the smarter, handsome one....` },
          { speaker:'Stefan', text:`Think about who's blunt with words like that.` }
        ],
        hint: 'It’s an angry, blunt, personal line'
      },
      {
        label: 'Kai',
        persona:'Damon',
        correct:false,
        dialogue:[
          { speaker:'Damon', text:`Not Kai — Kevin? No. Try again.` },
          { speaker:'Stefan', text:`Kai is different altogether. Not him.` },
          { speaker:'Damon', text:`This belongs to the Salvatore flair.` }
        ],
        hint: 'Not Kai — it has Salvatore written all over it.'
      }
    ],
    forceCorrect:true
  },

  // 8 quarrel (non-interactive, slow)
  { id:'quarrel', who:'Damon', lines:[
    `(A slow quarrel — teasing the way brothers do.)`,
    `— Damon: Raii.... that girl with the jaw that won't quit. She chose the chaos and then laughed. I said, "that’s mine to tease...."`,
    `— Stefan: She chooses people who remain... Not grand gestures, Damon presence... huh`,
    `— Damon: I am present... I just wear the presence loudly.`,
    `— Stefan: Loud isn't always kind. Remember that.`,
    `Hahahaa`
  ], pause: PAUSE_LONG },

  // 9 katherine (factual - force)
  { id:'katherine', who:'Damon', lines:[`Final lore one: Who turned Katherine into a vampire?`],
    options:[
      {
        label: 'Klaus Mikaelson',
        persona:'Damon',
        correct:true,
        dialogue:[
          { speaker:'Damon', text:`Correct. Klaus did that — and complications followed.` },
          { speaker:'Stefan', text:`You remembered that key betrayal. Well done.` },
          { speaker:'Damon', text:`${namePrimary}, you keep the lore — which makes you dangerous in quizzes.` }
        ]
      },
      {
        label: 'Elijah Mikaelson',
        persona:'Stefan',
        correct:false,
        dialogue:[
          { speaker:'Stefan', text:`Not Elijah there — good guess but no.` },
          { speaker:'Damon', text:`Wrong — here's a hint: big Original, bigger motives.` },
          { speaker:'Stefan', text:`Try the Klaus option; think Originals and mischief.` }
        ],
        hint: 'One of the Originals with a tendency to manipulate.'
      },
      {
        label: 'Unknown / other',
        persona:'Damon',
        correct:false,
        dialogue:[
          { speaker:'Damon', text:`Too vague. Not unknown — it's a named Original.` },
          { speaker:'Stefan', text:`The story reveals the name — pick Klaus.` },
          { speaker:'Damon', text:`Look for the option mentioning the Mikaelsons.` }
        ],
        hint: 'It’s an Original — think Mikaelson family.'
      }
    ],
    forceCorrect:true
  },

  // 10 final choice - personal
  { id:'finalChoice', who:'Damon', lines:[`Last — which 2AM text is you?`],
    options:[
      {
        label:`"Tell me something true."`,
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Brave. You choose truth at 2AM. Honest and raw.` },
          { speaker:'Stefan', text:`That takes courage. I respect that.` },
          { speaker:'Damon', text:`${namePrimary}, you prefer the sharp honesty. I like it.` },
          { speaker:'Stefan', text:`Keep someone you trust to hear it.` }
        ]
      },
      {
        label:`"Are you awake?"`,
        persona:'Stefan',
        dialogue:[
          { speaker:'Stefan', text:`Gentle. You check quietly.` },
          { speaker:'Damon', text:`A soft, small thing. Cute and dangerous.` },
          { speaker:'Stefan', text:`${namePrimary}, you know when to reach out.` },
          { speaker:'Damon', text:`I approve. And I'll answer at 2AM, annoyingly.` }
        ]
      },
      {
        label:`"Meet me where the trouble is."`,
        persona:'Damon',
        dialogue:[
          { speaker:'Damon', text:`Danger-lure.... Bold and fun...` },
          { speaker:'Stefan', text:`Girl You like the edges. and Rai That's your style.` },
          { speaker:'Damon', text:`${namePrimary}, you make adventure a habit.` },
          { speaker:'Stefan', text:`Promise you'll come back from those edges.` }
        ]
      }
    ]
  },

  // final scene (non-interactive)
  { id:'closing', who:'Damon', final:true, lines:[
    `(A hush.)`,
    `— Damon: ${namePrimary}, you played. You laughed and answered. That's the point.`,
    `— Stefan: You stayed. That matters far more than being right.`,
    `— Damon: Raii — maddening, brilliant, stubborn girl... Keep the mischief....`,
    `Wait there is something final...`
  ] }
];

/* ---------- Progress & Runner ---------- */
const totalInteractive = scenes.filter(s => Array.isArray(s.options) && s.options.length).length;
let interactiveDone = 0;
function updateProgress(){ const pct = Math.round((interactiveDone / totalInteractive) * 100); progressInner.style.width = pct + '%'; stageText.textContent = `Stage ${interactiveDone} / ${totalInteractive}`; progressInner.setAttribute('aria-valuenow', pct); }
updateProgress();

let pointer = 0;
let busy = false;

async function runScene(i){
  try{
    if(i < 0 || i >= scenes.length) return;
    busy = true;
    clearUI();
    const scene = scenes[i];
    speakerEl.textContent = (scene.who||'').toUpperCase();

    // type scene lines (slow)
    for(let t=0;t<(scene.lines||[]).length;t++){
      const el = newLine('line');
      await typeInto(el, scene.lines[t]);
      await wait(scene.pause || PAUSE_MED);
    }

    // if interactive options
    if(Array.isArray(scene.options) && scene.options.length){
      instructionEl.textContent = 'Choose one option below.';
      // render buttons
      scene.options.forEach((opt, idx)=>{
        const b = document.createElement('button');
        b.className = 'optionBtn';
        b.type = 'button';
        b.textContent = opt.label;
        b.addEventListener('click', async ()=>{
          if(!busy) return;
          setOptionsEnabled(false);
          // run the option-specific dialogue sequence
          // if option.correct exists and scene.forceCorrect true -> must be correct to proceed
          const force = !!scene.forceCorrect;
          const isCorrect = !!opt.correct;

          // if it's a factual (force) question and wrong -> show unique dialogue then hint and re-enable
          if(force && !isCorrect){
            // show option-specific dialogue lines (they exist, per data)
            if(Array.isArray(opt.dialogue)){
              for(const d of opt.dialogue){
                setSpeaking(d.speaker);
                const e = newLine('reply');
                await typeInto(e, d.text);
                await wait(PAUSE_SHORT);
              }
            } else {
              const generic = newLine('reply');
              setSpeaking(opt.persona || scene.who || 'Damon');
              await typeInto(generic, opt.wrongReply || `— ${opt.persona || scene.who}: Not quite.`);
              await wait(PAUSE_SHORT);
            }
            // show hint if present
            const hint = opt.hint || scene.hint;
            if(hint){
              const hintEl = newLine('reply');
              setSpeaking('Damon');
              await typeInto(hintEl, `Hint: ${hint}`);
              await wait(PAUSE_MED);
            } else {
              await wait(PAUSE_SHORT);
            }
            setOptionsEnabled(true);
            busy = true;
            setSpeaking(null);
            return; // allow retry
          }

          // else (either non-force question or correct answer) show the dialogue array (long)
          if(Array.isArray(opt.dialogue)){
            for(const d of opt.dialogue){
              setSpeaking(d.speaker);
              const el = newLine('reply');
              // personalize small: replace {NAME} tokens if present (use namePrimary/nameAlt)
              const text = d.text.replace(/\{NAME\}/g, namePrimary).replace(/\{RAI\}/g, nameAlt);
              await typeInto(el, text);
              await wait(PAUSE_MED);
            }
          } else {
            // fallback single reply
            const r = newLine('reply');
            setSpeaking(opt.persona || scene.who || 'Damon');
            await typeInto(r, opt.rightReply || `— ${opt.persona || scene.who}: Interesting choice.`);
            await wait(PAUSE_MED);
          }

          // optional followup
          if(Array.isArray(opt.followup)){
            for(const f of opt.followup){
              setSpeaking(f.speaker || 'Damon');
              const fe = newLine('reply');
              await typeInto(fe, f.text);
              await wait(PAUSE_MED);
            }
          }

          // mark interactive done and update progress
          interactiveDone = Math.min(totalInteractive, interactiveDone + 1);
          updateProgress();

          await wait(PAUSE_LONG);
          setSpeaking(null);
          busy = false;
          pointer++;
          return runScene(pointer);
        });
        optionsEl.appendChild(b);
      });

      // animate options in slowly (stagger)
      const btns = optionsEl.querySelectorAll('.optionBtn');
      btns.forEach((btn, idx) => {
        const delay = 600 + idx * 320;
        setTimeout(()=> btn.classList.add('visible'), delay);
      });
      // focus first after a bit
      setTimeout(()=> { const f = optionsEl.querySelector('button'); if(f) f.focus(); }, 900);

      busy = true;
      return;
    }

    // non-interactive continue screens
    if(scene.continue){
      instructionEl.textContent = 'When you are ready, continue.';
      const cont = document.createElement('button');
      cont.className = 'optionBtn visible';
      cont.textContent = 'Continue';
      cont.addEventListener('click', ()=>{
        pointer++;
        runScene(pointer);
      });
      continueWrap.appendChild(cont);
      busy = true;
      return;
    }

    // final scene
    if(scene.final){
      await wait(PAUSE_LONG);
      const a = document.createElement('a');
      a.className = 'optionBtn visible';
      a.textContent = 'Last msg from Damon or harry(just click)';
      a.href = 'final.html';
      finalWrap.appendChild(a);
      finalWrap.setAttribute('aria-hidden','false');
      setSpeaking(null);
      busy = false;
      return;
    }

    // default
    pointer++;
    busy = false;
    return runScene(pointer);

  } catch(err){
    console.error(err);
    clearUI();
    const e = newLine('line');
    await typeInto(e, `Oops — a script error happened. Open console for details: ${String(err).slice(0,200)}`);
    setSpeaking(null);
    busy = false;
  }
}

/* helper newLine */
function newLine(cls='line'){ const el=document.createElement('div'); el.className = cls; dialogueEl.appendChild(el); setTimeout(()=> window.scrollTo({ top: window.scrollY + 8, behavior:'smooth' }), 60); return el; }

/* init */
window.addEventListener('load', ()=>{
  // reset counters and progress
  interactiveDone = 0;
  updateProgress();
  pointer = 0;
  setTimeout(()=> runScene(pointer), 420);
});

/* keyboard 1..9 */
document.addEventListener('keydown', (e)=>{
  if(e.key >= '1' && e.key <= '9'){
    const idx = parseInt(e.key,10) - 1;
    const btns = optionsEl.querySelectorAll('button');
    if(btns[idx]) btns[idx].click();
  }
});
</script>
</body>
</html>
